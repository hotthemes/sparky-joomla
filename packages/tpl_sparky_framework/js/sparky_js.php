<?php
defined( '_JEXEC' ) or die( 'Restricted access' );

$jsoutput = '/* SPARKY DYNAMICALLY GENERATED JAVASCRIPT - DO NOT EDIT THIS FILE!
YOUR CHANGES WILL BE OVERWRITTEN AFTER NEXT SAVE OF TEMPLATE PARAMETERS!
You can add your custom JavaScript code in template options, under Custom tab or
you can edit file custom.js to add your JavaScript code. */
';

////////////// Menus
////////////////////

// remove units from dimensions

function removeUnits($dim) {
    if (strpos($dim, "@px")) {
        return str_replace("@px", "", $dim);
    }
    if (strpos($dim, "@em")) {
        return str_replace("@em", "", $dim);
    }
    if (strpos($dim, "@rem")) {
        return str_replace("@rem", "", $dim);
    }
}

if ($LoadMENU_Acc) {
    $jsoutput .= '
// Accordion menu

(function(jQuery, undefined) {
    jQuery.widget("hjt.accmenu", {
        options: {
            collapsible: true,
            equalheight: false,
            event:"click",//click|mouseover
            animation:"slide", //bounceslide|slide
            subpanelslide:"right",// right|down
            subpanelspeed:450
        },
        
        _create: function() {
            var self = this,
                options = self.options;
            var el = jQuery(this.element);
            
            el.accordion({
                autoHeight: options.equalheight,
                collapsible: options.collapsible,
                event: options.event,
                animated: options.animation,
                navigation:true
            });
            
            el.find("> li > a").click(function(){
                if(!jQuery(this).parent().find("ul, li")[0]){
                    var link = jQuery(this).attr("href");
                    if(link == "#" || link == "javascript:;" || link == "javascript:void(0);") return;
                    window.location = link;
                }
            });
            
            el.find("> li > ul > li  ul").css({
                display:"none",
                position:"absolute"
            });
            
            el.find("> li > ul > li, > li > ul > li ul li ").each(function(ind){
                if(jQuery(this).find("> ul")[0]){
                    jQuery(this).find("> ul").insertBefore(jQuery(this).find("> a"));
                    var parMargin = 0;
                    var par = jQuery(this).parent();
                
                    while(!par.parent().parent().hasClass("acc")){
                        if(par.is("ul")){
                            parMargin += parseInt(par.css("marginLeft") );
                        }
                        par = par.parent();
                    }
             
                    if(el.position().left < (jQuery(window).width() - el.innerWidth()) / 2){
                        jQuery(this).find("> ul").find("> li").innerWidth(el.innerWidth() - 10);
                        jQuery(this).find("> ul").css("marginLeft",String( parMargin + jQuery(this).parent().innerWidth() - parseInt(jQuery(this).css("paddingLeft"))  - parseInt(jQuery(this).css("marginLeft")) ) + "px");
                
                    } else {
                        jQuery(this).find("> ul").find("> li").innerWidth(el.innerWidth() - 10); 
                        jQuery(this).find("> ul").css("marginLeft","-" + String(  (-parMargin) + jQuery(this).parent().innerWidth()) + "px");
                    } 
                }
            });
            
            el.find("> li > ul > li, > li > ul > li ul li ").mouseenter(function(){
                if(jQuery(this).find("> ul")[0]){
                    jQuery(this).find("> ul").css("zIndex",parseInt(jQuery(this).find("> ul").css("zIndex")) + 1);
                    if(options.subpanelslide == "right"){
                        jQuery(this).find("> ul:::not(visible)").animate({width:"toggle"},options.subpanelspeed);
                    } else {
                        jQuery(this).find("> ul:::not(visible)").slideDown(options.subpanelspeed);
                    }
                } 
            });
            
            el.find("> li > ul > li, > li > ul > li ul li ").mouseleave(function(){
                if(jQuery(this).find("> ul")[0]){
                    if(options.subpanelslide == "right"){
                        jQuery(this).find("> ul:visible").animate({width:"toggle"},options.subpanelspeed/3);
                    } else {
                        jQuery(this).find("> ul:visible").slideUp(0);
                    }
                }
            });
        },

        _setOption: function(key, value) {
            this.options[key] = value;
        },

        destroy: function() {
            jQuery(this.element).html(this._baseHTML);
            jQuery.Widget.prototype.destroy.call(this);
        }
    }); // widget
})(jQuery);

';

    foreach($mnucfg as $menu_name => $menu){
        if ($menu['type'] == "acc" || strpos($menu['type'], "acc")) {
            $jsoutput .= '
jQuery(document).ready(function(){
    jQuery(".mnu_'.$menu_name.'").accmenu({
        collapsible:';
            if ($menu['collapsible'] == "1") {
                $jsoutput .= '"true"';
            } else {
                $jsoutput .= '"false"';
            }
            $jsoutput .= ',
        equalheight:';
            if ($menu['equalheight'] == "1" ) {
                $jsoutput .= '"true"';
            } else {
                $jsoutput .= '"false"';
            }
            $jsoutput .= ',
        event:"'.$menu['trigger'].'",
        animation:"'.$menu['animation'].'",
        subpanelslide:"'.$menu['subpanelslide'].'",
        subpanelspeed: '.$menu['animation_speed'].'
    });
});
';
        }
    }
}

if ($LoadMENU_Navv) {

    foreach($mnucfg as $menu_name => $menu) {

        // cut dashes from menu names to prevent JS error
        $menu_name_correct = str_replace("-", "", $menu_name);

        $responsiveMenuTriggerValue1 = removeUnits($tparams->responsiveMenuTriggerValue);
        $responsiveMenuTriggerValue1 -= 1;

        if($menu["type"] == "navv" || strpos($menu["type"], "navv")) {
            $jsoutput .= '
// Drop-down menu

function isAppleDevice(){
    return (
        (navigator.userAgent.toLowerCase().indexOf("ipad") > -1) ||
        (navigator.userAgent.toLowerCase().indexOf("iphone") > -1) ||
        (navigator.userAgent.toLowerCase().indexOf("ipod") > -1)
    );
}

(function(jQuery){  
    jQuery.fn.dropDownMenu_'.$menu_name_correct.' = function(options) {  
  
        var defaults = {  
            speed: 300,  
            effect: "fadeToggle"
        };  
        var options = jQuery.extend(defaults, options);  
      
        return this.each(function() {

            var screenWidth = jQuery("body").width();

            jQuery(".mnu_'.$menu_name.' ul").hide();
            jQuery(".mnu_'.$menu_name.' li ul li").filter(":last-child").css("border-bottom", "none");

            if(screenWidth > '.$responsiveMenuTriggerValue1.') {

                jQuery(".mnu_'.$menu_name.' li").hover(function(){
                    jQuery(this).children("ul").stop()[options.effect](options.speed);
                },function(){
                    jQuery(this).css("position","relative").children("ul").stop()[options.effect](options.speed);
                });

            } else {

                jQuery(".mnu_'.$menu_name.' li a[href=\'#\']").toggle(function(){
                    jQuery(this).parent().find("ul:first:not(:visible)").stop(true,true)[options.effect](options.speed);
                },function(){
                    jQuery(this).parent().css("position", "relative").find("ul:first:visible").stop(true,true)[options.effect](options.speed);
                });
                                        
                jQuery("nav ul.navv").find("li > ul").prev().addClass("firstClick");        

            }
            jQuery(document).on("click",".mnu_'.$menu_name.' a", function(){
                if(!jQuery(this).hasClass("firstClick"))
                    jQuery(this).addClass("firstClick");
                
                return true;
            });
            
            
            jQuery(document).on("click",".mnu_'.$menu_name.' .firstClick",function(e){    
                if((jQuery("html.no-touchevents").length == 1 && screenWidth > '.removeUnits($tparams->responsiveMenuTriggerValue).') || (isAppleDevice() && screenWidth > '.removeUnits($tparams->responsiveMenuTriggerValue).')){
                    return true;
                }
                e.preventDefault(); 

                var href = jQuery(this).attr("href");
                var target = jQuery(this).attr("target");
                var link = jQuery(this);
                jQuery(this).attr("href","#");
                jQuery(this).attr("target","");
                
                jQuery(this).removeClass("firstClick");
                
                setTimeout(function(){
                    link.attr("href",href);
                    link.attr("target",target);
                },200);
                if(screenWidth > '.removeUnits($tparams->responsiveMenuTriggerValue).'){
                    jQuery(this).children("ul").stop()[options.effect](options.speed);
                }           
                else
                    jQuery(this).parent().find("ul:first:not(:visible)").stop(true,true)[options.effect](options.speed);
            });
            
            jQuery(window).resize(function(){
                var screenWidth = jQuery("body").width();
                if(screenWidth > '.removeUnits($tparams->responsiveMenuTriggerValue).')
                    jQuery("nav ul.navv").find("li > ul").prev().removeClass("firstClick");
                else
                    jQuery("nav ul.navv").find("li > ul").prev().addClass("firstClick");
            });
            
        });  
    };  
})(jQuery);

jQuery(document).ready(function(){
    jQuery(".mnu_'.$menu_name.'").dropDownMenu_'.$menu_name_correct.'({
        speed: '.$menu["animation_speed"].',
        effect: "'.$menu["animation_effect"].'"
    });
    
    //hover menu fix    
    setTimeout(function(){
        jQuery("#blocker").remove();
        jQuery("nav ul.navv").find("li > ul").prev().addClass("firstClick");
    }, 1000)
    
});
';
        }
    }
}


if ($LoadMENU_Navh) {
    $jsoutput .= '
// Horizontal menu

jQuery(document).ready(function(){

  jQuery("ul.navh").each(function(ind){
    var navh  = jQuery(this);
    var navhs = jQuery(\'<div class="navh_submenu"></div><div class="clr"></div>\');
    navhs.insertAfter(navh);
     
    navh.find("> li").each(function(ind){
        jQuery(this).attr("iindex",ind);
        if(jQuery(this).find("> ul")[0]){
            jQuery(this).find("> ul").attr("iindex",ind);
        }
    });
     
    navh.find("> li > ul").appendTo(navhs);
     
     navhs.find("> ul").css("zIndex",100);
     navh.find("> li.active").addClass("active_tab");
     navhs.find("> ul[iindex=\'" + navh.find("> li.active").attr("iindex") + "\']").css("zIndex",80).addClass("current_sub active_sub");
     
     navhs.find("> ul li.parent").hover(
         function(){
            jQuery(this).children("ul").stop().slideToggle();
         },
         function(){
            jQuery(this).children("ul").stop().slideToggle();
         }
     );
     
     navhs.find("> ul ul").stop().slideToggle();
      
     navh.find("> li:not(.current)").hover(
     function(){
        
        navh.find(".in_hover").removeClass("in_hover");
        navhs.find(".in_hover").removeClass("in_hover");
        
        navh.find(".active_tab").removeClass("active_tab");
        navhs.find(".active_sub").removeClass("active_sub");
        
        jQuery(this).addClass("active_tab in_hover");
        navhs.find("> ul[iindex=\'" + jQuery(this).attr("iindex") + "\']").addClass("active_sub");
        
     },
     function(){
        jQuery(this).removeClass("in_hover");
        var mitem = jQuery(this);
        var stab  = navhs.find("> ul[iindex=\'" + mitem.attr("iindex") + "\']");
        
        setTimeout(function(){
            if(!(stab.is(".in_hover") || mitem.is(".in_hover"))){
                if(!(navh.find(".in_hover")[0] || navhs.find(".in_hover")[0])){
                    mitem.removeClass("active_tab");
                    stab.removeClass("active_sub");
                    navh.find("> li.active").addClass("active_tab");
                    navhs.find("> ul[iindex=\'" + navh.find("> li.active").attr("iindex") + "\']").addClass("active_sub");
                }
            }
        },50);
     });
     
     navhs.find("> ul:not(.current_sub)").hover(
     function(){
        navh.find(".in_hover").removeClass("in_hover");
        navhs.find(".in_hover").removeClass("in_hover");
        jQuery(this).addClass("in_hover");
     },
     function(){
        jQuery(this).removeClass("in_hover");
        
        var stab  = jQuery(this);
        var mitem = navh.find("> li[iindex=\'" + stab.attr("iindex") + "\']");
        
        setTimeout(function(){
            if(!(stab.is(".in_hover") || mitem.is(".in_hover"))){
                if(!(navh.find(".in_hover")[0] || navhs.find(".in_hover")[0])){
                    mitem.removeClass("active_tab");
                    stab.removeClass("active_sub");
                    
                    navh.find("> li.active").addClass("active_tab");
                    navhs.find("> ul[iindex=\'" + navh.find("> li.active").attr("iindex") + "\']").addClass("active_sub");
                }
            }
        },50);
     }
     );
  });

});
';
}

if ($LoadMENU_Mega) {
    foreach($mnucfg as $menu_name => $menu) {
        if ($menu["type"] == "mega") {
            $jsoutput .= '
// Mega menu

(function(jQuery, undefined) {
    jQuery.widget("hjt.megamenu", {
        options: {
            fade: true,
            slide: true,
            animation_speed: "slow",
            down_arrows: true,
            mega_pane_width: 160,
            pane_border_size: 1
        },

        _BaseHTML: "",
        _Container: null,
        _InnerElements: null,
        _AnimatedItem: null,

        _create: function() {
            var self = this,
                options = self.options;
            var $el = jQuery(this.element);

            $el.hide();

            var n = 0;
            $el.find(\'.separator, a:contains("#LOAD#"), a:contains("#load#"), a:contains("#Load#")\').each(function(index) {
                var sHtml = jQuery(jQuery(document).find(".megamenu_separator" + String(n + 1))[0]);
                if (sHtml[0]) {
                    sHtml.remove();
                    jQuery(jQuery(this)[0]).replaceWith(sHtml);
                }
                n++;
            });
            
            $el.addClass("hjt-megamenu-menubar");
            $el.children().addClass("hjt-megamenu-menubar-item");

            $el.show();
            $el.children().each(function(index) {
                if (this.nodeName.toUpperCase() == "LI") {
                    var ULs = jQuery(this).find("UL").length - jQuery(this).find(\'*[class*="megamenu_separator"] UL\').length;
                    if (ULs > 0) {

                        try {
                            if (options.down_arrows) {
                                jQuery(jQuery(this).find("A")[0]).append(jQuery("<span class=\'hjt-megamenu-menubar-droparrow\' >&nbsp;</span>"));
                            }
                        } catch (ecx) {
                        }

                        var Cols = ULs;

                        var i = 0;
                        var sTDs = "";
                        for (i = 0; i < Cols; i++) {
                            sTDs = sTDs + "<div class=\'hjt-megamenu-dropdown-panel-content\' ></div>";
                        }

                        var DropDownDiv = jQuery("<div class=\'hjt-megamenu-dropdown-panel\'><div class=\'mega_menu_table\'>" + sTDs + "</div></div>");

                        var Cells = DropDownDiv.find(\'.hjt-megamenu-dropdown-panel-content\');
                        var c = 0;
                        var r = 0;

                        jQuery(this).children("ul").each(function(index) {
                            jQuery(this).remove();
                            var Multiple = false;
                            var Title = null;

                            jQuery(this).children("li").each(function(index) {
                                jQuery(this).children("ul").each(function(index) {
                                    Multiple = true;
                                    try {
                                        if (this.parentNode.children[0].nodeName != "ul") {
                                            Title = jQuery(this.parentNode.children[0]);
                                            Title.addClass("hjt-megamenu-dropdown-panel-list-title");
                                        }
                                    } catch (exp) { }
                                    if (Title != null) jQuery(Cells[r * Cols + c]).append(Title);
                                    jQuery(Cells[r * Cols + c]).append(jQuery(this));
                                    jQuery(this).addClass("hjt-megamenu-dropdown-panel-list");
                                    c++;
                                    if (c == Cols) {
                                        c = 0;
                                        r++;
                                    }
                                });
                            });

                            if (Multiple == false) {
                                jQuery(Cells[r * Cols + c]).append(jQuery(this));
                                jQuery(this).addClass("hjt-megamenu-dropdown-panel-list");
                                c++;
                                if (c == Cols) {
                                    c = 0;
                                    r++;
                                }
                            }
                        });

                        jQuery(this).append(DropDownDiv);

                        if (DropDownDiv.innerWidth() < jQuery(this).innerWidth()) {
                            DropDownDiv.find(".mega_menu_table").css({ minWidth: jQuery(this).innerWidth() + "px" });
                            DropDownDiv.find(".mega_menu_table").css({ width: jQuery(this).innerWidth() + "px" });
                        }

                        if (options.slide) {
                            DropDownDiv.animate({ height: "toggle" }, 0);
                            DropDownDiv.animate({ height: "toggle" }, 0);
                        }
                    }
                }
                jQuery(this).addClass("hjt-megamenu-menubar-item-normal");
                jQuery(this).bind("mouseenter", { Sender: jQuery(this), Self: self }, self.onBarItem_Enter);
                jQuery(this).bind("mouseleave", { Sender: jQuery(this), Self: self }, self.onBarItem_Leave);
            });
            
            jQuery(window).resize(function(){
                if(self._AnimatedItem){
                    if(self._AnimatedItem.is(":visible")){
                        self.positionDropDown(self._AnimatedItem);
                    }
                }
            });

            // remove empty panels

            jQuery( ".hjt-megamenu-dropdown-panel-content" ).each(function() {
                if ( jQuery(this).children().length == 0 ) {
                    jQuery(this).remove();
                }
            });

            // check if drop-down panel width should be reduced

            var drop_down_panes, drop_down_pane_width, needed_pane_width;

            jQuery( ".hjt-megamenu-menubar-item" ).each(function() {

                drop_down_panes = jQuery(this).find(".hjt-megamenu-dropdown-panel-content").length;
                drop_down_pane_width = jQuery(this).children(".hjt-megamenu-dropdown-panel").width();
                needed_pane_width = drop_down_panes * options.mega_pane_width + options.pane_border_size * 2;

                if (needed_pane_width < drop_down_pane_width) {
                    jQuery(this).children(".hjt-megamenu-dropdown-panel").css("width", needed_pane_width + "px");
                }

            });

            var screenWidth = jQuery("body").width();
            ';

            if($menu['modules_mobile'] != 1) {
                $jsoutput .= '

            // remove modules on mobile (if enabled)

            jQuery( ".hjt-megamenu-dropdown-panel-content" ).each(function() {
                if ( screenWidth < '.removeUnits($tparams->responsiveMenuTriggerValue).' ) {
                    if ( jQuery(this).find("[class^=\'megamenu_separator\']").length > 0 ) {
                        jQuery(this).remove();
                    }
                }
            });';
            }

            $jsoutput .= '

            // double tap needed on mobiles if menu item is linked and has children

            if( screenWidth < '.removeUnits($tparams->responsiveMenuTriggerValue).' ) {
                jQuery(".touchevents ul.mega").find("li > .hjt-megamenu-dropdown-panel").prev().addClass("firstClick");
            }

            jQuery(".firstClick").on("click", function(e){
                if(jQuery(this).hasClass("firstClick")) {
                    jQuery(this).removeClass("firstClick");
                    e.preventDefault();
                } else {
                    return true;
                }
            });
            
            

        },

        _setOption: function(key, value) {
            this.options[key] = value;
        },

        positionDropDown:function(Panel){';

                $jsoutput .= '
            var offView = (jQuery(window).width() - Panel.parent().offset().left) - Panel.innerWidth();
            var forBorder;

            if (offView > 0) {
                forBorder = 0;
                offView = 0;
                Panel.css("left",(Panel.parent().position().left + offView - forBorder) + "px");
            } else {
                Panel.css("right", 0);
            };
            
            ';

            $jsoutput .= '

        },
        onBarItem_Enter: function(eArgs) {
            var Sender = eArgs.data.Sender;
            var options = eArgs.data.Self.options; 
            if(Sender.hasClass("hjt-megamenu-menubar-item-hover")) return;
            Sender.addClass("hjt-megamenu-menubar-item-hover").removeClass("hjt-megamenu-menubar-item-normal");
            var Panels = Sender.find(".hjt-megamenu-dropdown-panel");
            if (Panels.length > 0) {
                if (eArgs.data.Self._AnimatedItem != null) {
                    eArgs.data.Self._AnimatedItem.stop(true, true);
                }
                eArgs.data.Self._AnimatedItem = jQuery(Panels[0]);
                eArgs.data.Self.positionDropDown(eArgs.data.Self._AnimatedItem);
                
                if (options.fade && options.slide) {
                    jQuery(Panels[0]).animate({ opacity: "toggle", height: "toggle" }, options.animation_speed);
                } else if (options.fade) {
                    jQuery(Panels[0]).animate({ opacity: "toggle" }, options.animation_speed);
                } else if (options.slide) {
                    jQuery(Panels[0]).animate({ height: "toggle" }, options.animation_speed);
                } else {
                    jQuery(Panels[0]).show();
                }

                var MaxWidth = 0;
                jQuery(Panels[0]).find(".hjt-megamenu-dropdown-panel-content").each(function(index) {
                    if (jQuery(this).innerWidth() > MaxWidth) {
                        MaxWidth = jQuery(this).innerWidth();
                    }
                });

            }
        },

        onBarItem_Leave: function(eArgs) {
            var Sender = eArgs.data.Sender;
            var options = eArgs.data.Self.options;
            Sender.addClass("hjt-megamenu-menubar-item-normal").removeClass("hjt-megamenu-menubar-item-hover");
            var Panels = Sender.find(".hjt-megamenu-dropdown-panel");
            if (Panels.length > 0) {
                if (eArgs.data.Self._AnimatedItem != null) {
                    eArgs.data.Self._AnimatedItem.stop(true, true);
                }
                eArgs.data.Self._AnimatedItem = jQuery(Panels[0]);
                if (options.fade && options.slide) {
                    jQuery(Panels[0]).animate({ opacity: "toggle", height: "toggle" }, options.animation_speed);
                }
                else if (options.fade) {
                    jQuery(Panels[0]).animate({ opacity: "toggle" }, options.animation_speed);
                }
                else if (options.slide) {
                    jQuery(Panels[0]).animate({ height: "toggle" }, options.animation_speed);
                }
                else {
                    jQuery(Panels[0]).hide();
                }
            }
        },

        destroy: function() {
            jQuery(this.element).html(this._baseHTML);
            jQuery.Widget.prototype.destroy.call(this);
        }

    }); // widget
})(jQuery);

';
        }
    }

    foreach($mnucfg as $menu_name => $menu){
        if ($menu['type'] == "mega" || strpos($menu['type'], "mega")) {
            $jsoutput .= '
jQuery(document).ready(function() {
    jQuery(".mnu_'.$menu_name.'").megamenu({
        fade:';
        if ($menu['fade'] == "1") {
            $jsoutput .= 'true';
        } else {
            $jsoutput .= 'false';
        }
        $jsoutput .= ',
        slide:';
        if ($menu['slide'] == "1") {
            $jsoutput .= 'true';
        } else {
            $jsoutput .= 'false';
        }
        $jsoutput .= ',
        animation_speed: '.$menu['animation_speed'].',
        down_arrows:';
        if ($menu['arrows'] == "1") {
            $jsoutput .= 'true';
        } else {
            $jsoutput .= 'false';
        }
        $jsoutput .= ',
        mega_pane_width: '.$menu['mega_pane_width'].',
        pane_border_size: '.$menu['pane_border_size'].'

    });
});
';
        }
    }
}

////////////// Modernizr
////////////////////////

$jsoutput .= '
/*! modernizr 3.3.1 (Custom Build) | MIT *
 * http://modernizr.com/download/?-touchevents-setclasses !*/
!function(e,n,t){function o(e,n){return typeof e===n}function s(){var e,n,t,s,a,i,r;for(var l in c)if(c.hasOwnProperty(l)){if(e=[],n=c[l],n.name&&(e.push(n.name.toLowerCase()),n.options&&n.options.aliases&&n.options.aliases.length))for(t=0;t<n.options.aliases.length;t++)e.push(n.options.aliases[t].toLowerCase());for(s=o(n.fn,"function")?n.fn():n.fn,a=0;a<e.length;a++)i=e[a],r=i.split("."),1===r.length?Modernizr[r[0]]=s:(!Modernizr[r[0]]||Modernizr[r[0]]instanceof Boolean||(Modernizr[r[0]]=new Boolean(Modernizr[r[0]])),Modernizr[r[0]][r[1]]=s),f.push((s?"":"no-")+r.join("-"))}}function a(e){var n=u.className,t=Modernizr._config.classPrefix||"";if(p&&(n=n.baseVal),Modernizr._config.enableJSClass){var o=new RegExp("(^|\\s)"+t+"no-js(\\s|$)");n=n.replace(o,"$1"+t+"js$2")}Modernizr._config.enableClasses&&(n+=" "+t+e.join(" "+t),p?u.className.baseVal=n:u.className=n)}function i(){return"function"!=typeof n.createElement?n.createElement(arguments[0]):p?n.createElementNS.call(n,"http://www.w3.org/2000/svg",arguments[0]):n.createElement.apply(n,arguments)}function r(){var e=n.body;return e||(e=i(p?"svg":"body"),e.fake=!0),e}function l(e,t,o,s){var a,l,f,c,d="modernizr",p=i("div"),h=r();if(parseInt(o,10))for(;o--;)f=i("div"),f.id=s?s[o]:d+(o+1),p.appendChild(f);return a=i("style"),a.type="text/css",a.id="s"+d,(h.fake?h:p).appendChild(a),h.appendChild(p),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(n.createTextNode(e)),p.id=d,h.fake&&(h.style.background="",h.style.overflow="hidden",c=u.style.overflow,u.style.overflow="hidden",u.appendChild(h)),l=t(p,e),h.fake?(h.parentNode.removeChild(h),u.style.overflow=c,u.offsetHeight):p.parentNode.removeChild(p),!!l}var f=[],c=[],d={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,n){var t=this;setTimeout(function(){n(t[e])},0)},addTest:function(e,n,t){c.push({name:e,fn:n,options:t})},addAsyncTest:function(e){c.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=d,Modernizr=new Modernizr;var u=n.documentElement,p="svg"===u.nodeName.toLowerCase(),h=d._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];d._prefixes=h;var m=d.testStyles=l;Modernizr.addTest("touchevents",function(){var t;if("ontouchstart"in e||e.DocumentTouch&&n instanceof DocumentTouch)t=!0;else{var o=["@media (",h.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");m(o,function(e){t=9===e.offsetTop})}return t}),s(),a(f),delete d.addTest,delete d.addAsyncTest;for(var v=0;v<Modernizr._q.length;v++)Modernizr._q[v]();e.Modernizr=Modernizr}(window,document);
';

////////////// Font resize
//////////////////////////

if ($font_resize_enabled) {
    $jsoutput .= '
// Font resize

var sitefunctions = {
    textresize: function() {
        try {
            if (!jQuery.cookie) {
                jQuery.cookie = function(name, value, options) {
                    if (typeof value != "undefined") { // name and value given, set cookie
                        options = options || {};
                        if (value === null) {
                            value = "";
                            options.expires = -1;
                        }
                        var expires = "";
                        if (options.expires && (typeof options.expires == "number" || options.expires.toUTCString)) {
                            var date;
                            if (typeof options.expires == "number") {
                                date = new Date();
                                date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
                            } else {
                                date = options.expires;
                            }
                            expires = "; expires=" + date.toUTCString(); // use expires attribute, max-age is not supported by IE
                        }
                        // CAUTION: Needed to parenthesize options.path and options.domain
                        // in the following expressions, otherwise they evaluate to undefined
                        // in the packed version for some reason...
                        var path = options.path ? "; path=" + (options.path) : "";
                        var domain = options.domain ? "; domain=" + (options.domain) : "";
                        var secure = options.secure ? "; secure" : "";
                        document.cookie = [name, "=", encodeURIComponent(value), expires, path, domain, secure].join("");
                    } else { // only name given, get cookie
                        var cookieValue = null;
                        if (document.cookie && document.cookie != "") {
                            var cookies = document.cookie.split(";");
                            for (var i = 0; i < cookies.length; i++) {
                                var cookie = jQuery.trim(cookies[i]);
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) == (name + "=")) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                };
            }  
        } catch(exc) {
        }
        // show text resizing links
        jQuery(".FontSize").show();
        var $cookie_name = "sitename-FontSize";
        var originalFontSize = jQuery("body").css("font-size");
        // if exists load saved value, otherwise store it
        if(jQuery.cookie($cookie_name)) {
            var $getSize = jQuery.cookie($cookie_name);
            jQuery("body").css({fontSize : $getSize + ($getSize.indexOf("px")!=-1 ? "" : "px")}); // IE fix for double "pxpx" error
        } else {
            jQuery.cookie($cookie_name, originalFontSize);
        }
        // reset link
        jQuery(".resetFont").bind("click", function() {
            jQuery("body").css("font-size", originalFontSize);
            jQuery.cookie($cookie_name, originalFontSize);
        });
        // text "+" link
        jQuery(".increaseFont").bind("click", function() {
            var currentFontSize = jQuery("body").css("font-size");
            var currentFontSizeNum = parseFloat(currentFontSize, 10);
            var newFontSize = currentFontSizeNum+1;
            if (newFontSize,  11) {
                jQuery("body").css("font-size", newFontSize);
                jQuery.cookie($cookie_name, newFontSize);
            }
            return false;   
        });
        // text "-" link
        jQuery(".decreaseFont").bind("click", function() {
            var currentFontSize = jQuery("body").css("font-size");
            var currentFontSizeNum = parseFloat(currentFontSize, 10);
            var newFontSize = currentFontSizeNum-1;
            if (newFontSize, 11) {
                jQuery("body").css("font-size", newFontSize);
                jQuery.cookie($cookie_name, newFontSize);
            }
            return false;
        });
    }
}
 
jQuery(document).ready(function(){
    sitefunctions.textresize(); 
});
';
}
